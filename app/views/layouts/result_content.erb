<!DOCTYPE html>
<html>
<head>
  <%= render partial: 'layouts/head' %>
  <title><%= t(:markus) %> - <%= controller.action_name.titleize %></title>
  <%# React stuff (compressed version + JSX transformer) %>
  <%= javascript_include_tag 'https://cdnjs.cloudflare.com/ajax/libs/react/0.11.0/react.min.js',
                             'https://cdnjs.cloudflare.com/ajax/libs/react/0.11.0/JSXTransformer.js' %>
  <%= javascript_include_tag 'application' %>
  <% # UI LIBRARIES %>
  <%= javascript_include_tag 'menu',
                             'layouts',
                             'help-system' %>
  <%= yield :head %>
</head>
<body>
<div id='<%= controller.action_name == "login" ? "loggedOut" : "loggedIn" %>'>
  <div id='mobile_menu'>
    <a id='menu_icon'></a>
  </div>
  <div id='wrapper' class='wrapper_flex'>
    <nav id='menus'>
      <div id='menus_child'>
        <%= render partial: 'layouts/header' %>
        <%= render partial: 'layouts/menu' %>
        <%= render partial: 'layouts/sub_menu' %>
        <%= render partial: 'layouts/sub_sub_menu' %>
        <%= render partial: 'layouts/footer' %>
      </div>
      <%= render partial: 'layouts/about' %>
      <%= render partial: 'layouts/role_switch' %>
      <%= render partial: 'layouts/redirect' %>
    </nav>

    <div class='top_bar' style="display: none">
      <div id='working' style='display:none;'>
        <span><%= t(:working) %></span>
        <span id='ellipsis'></span>
      </div>
      <div class='results_title_bar'>
        <div class='logo_img flex_vertical_center'>
          <a href='<%= root_url %>' id='results-logo-img'></a>
        </div>
        <h3 class='title_text flex_vertical_center'>
        <%= t('results.title',
              { assignment_name: @assignment.short_identifier,
                group_name: @current_user.student? ? t('assignment.review') : @grouping.get_group_name }) %>
        </h3>
        <div class='header_text_links flex_vertical_center'>
          <a onclick='compact_view_toggle()'>Normal View</a>
        </div>
      </div>
    </div>
    <%
      if @current_user.admin? then
        num_marked = @assignment.get_num_marked()
        num_assigned = @assignment.get_num_assigned()
      else
        num_marked = @assignment.get_num_marked(@current_user.id)
        num_assigned = @assignment.get_num_assigned(@current_user.id)
      end
    %>
    <section id='content'>
      <div class="progress_meter">
        <span id="progress_span"><p>
          <%= t('browse_submissions.how_many_marked',
                num_marked: num_marked,
                num_assigned: num_assigned)%>
        </p></span>
      </div>
      <%= render partial: 'layouts/noscript'%>
      <%= content_for?(:content) ? yield(:content) : yield %>
    </section>
    <script type="text/javascript">
        var marked = <%= num_marked %>
        var total = <%= num_assigned %>
        function update_bar(score, outof){
            var width = (score/outof) * 100;
            var bar = $('#progress_span');
            bar.css('width', width + '%');
            if(width > 75){
                bar.css('background-color', 'green')
            }else if(width > 25){
                bar.css('background-color', 'yellow')
            }
        }
        update_bar(marked, total);
        $(document).on("click","#toggle_marking_state input[value='Revert to Incomplete']",function() {
            marked = marked - 1;
            update_bar(marked, total);
        });
        $(document).on("click","#toggle_marking_state input[value='Set to Complete']",function() {
            marked = marked + 1;
            update_bar(marked, total);
        });
    </script>
    <div id='footer_wrapper'><%= render partial: 'layouts/footer' %></div>
  </div>

</div>

<%= render partial: 'layouts/redirect', formats: [:js], handlers: [:erb] %>

<script>
  $(document).ready(function($) {
    setInterval(function() {
      $.get('<%= check_timeout_main_index_path %>');
    }, 120000);
  });
</script>
</body>
</html>
